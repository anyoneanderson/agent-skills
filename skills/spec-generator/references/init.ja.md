# Init Phase - 要件定義の生成

## 概要

要件定義書（requirement.md）を生成するフェーズ。
ユーザーとの対話または既存の会話履歴から要件を抽出・整理する。

## 実行手順

### 1. コンテキスト確認

```
会話履歴あり → 会話内容から要件を抽出
会話履歴なし → 対話モードで要件を探索
--quick指定 → プロジェクト概要から推測して生成
--analyze指定 → 既存コードを分析
```

### 2. 既存プロジェクトの分析（--analyze）

既存コードがある場合:
```bash
find . -type f -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.java" -o -name "*.go" | head -20
```

分析項目:
- プロジェクト構造とアーキテクチャ
- 既存の機能
- 依存関係と技術スタック
- コードパターンと規約

### 3. 対話モード（AskUserQuestion 活用）

**原則: 選択肢に落とせる質問は必ず AskUserQuestion を使う。**
オープンエンドな質問（プロジェクト名、コンセプト説明等）のみテキストで聞く。

#### 標準対話

AskUserQuestion を使って段階的に情報を収集する。
質問ラウンド数はプロジェクトの複雑さに応じて柔軟に調整。

**ラウンド1: 基本情報（3-4問を同時に）**

```
Q1: "プロジェクトの種別は？"
header: "Type"
options:
  - "Webアプリ" / "フロントエンド + バックエンド"
  - "APIサーバー" / "バックエンドのみ"
  - "CLIツール" / "コマンドラインツール"
  - "モバイルアプリ" / "iOS/Android"

Q2: "プロジェクトの規模感は？"
header: "Scale"
options:
  - "小規模（1-2画面、数機能）"
  - "中規模（5-10画面、複数ドメイン）"
  - "大規模（10+画面、複雑なドメイン）"

Q3: "想定ユーザーは？"
header: "Users"
options:
  - "自分だけ / 個人ツール"
  - "チーム / 社内向け"
  - "一般公開 / BtoC"
  - "企業顧客 / BtoB"

Q4: "認証は必要ですか？"
header: "Auth"
options:
  - "不要"
  - "基本認証（メール+パスワード）"
  - "ソーシャルログイン含む"
  - "SSO / エンタープライズ認証"
```

**ラウンド2: 技術選択（ラウンド1の回答に応じて調整）**

Webアプリの場合:
```
Q1: "フロントエンドのフレームワークは？"
header: "Frontend"
options:
  - "Next.js (Recommended)"
  - "React (SPA)"
  - "Vue / Nuxt"
  - 未定 → Other

Q2: "データベースは？"
header: "Database"
options:
  - "PostgreSQL (Recommended)"
  - "MySQL"
  - "MongoDB"
  - "SQLite（小規模向け）"

Q3: "デプロイ先は？"
header: "Deploy"
options:
  - "Vercel / Netlify"
  - "AWS / GCP"
  - "Docker / セルフホスト"
  - "未定"
```

**ラウンド3（必要な場合のみ）: 追加要件**

```
Q1: "国際化（多言語対応）は必要ですか？"
header: "i18n"
options:
  - "不要"
  - "日英2言語"
  - "3言語以上"

Q2: "他に重要な要件はありますか？" → multiSelect: true
header: "Features"
options:
  - "リアルタイム更新"
  - "ファイルアップロード"
  - "メール通知"
  - "外部API連携"
```

**注意:**
- ラウンド1の回答でプロジェクトが十分明確なら、ラウンド2で生成に進む
- ラウンド2の回答で不明点がなければ、ラウンド3は省略
- ユーザーが「Other」で自由記述した場合、その内容を踏まえて必要なら追加質問

#### ソクラテス式深掘り（--deep）

AskUserQuestion で本質から探索。通常より多くのラウンドを使う。

```
ラウンド1: 目的と動機
Q1: "このプロジェクトで解決したい一番の課題は？"
Q2: "現在はどうやってこの課題に対処していますか？"

ラウンド2: ユーザーと価値（ラウンド1の回答に基づく）
Q1: "最も恩恵を受けるユーザーは誰？"
Q2: "ユーザーがこのツールで最初にやることは？"

ラウンド3: 制約と優先順位
Q1: "最も重要な品質属性は？"
  options: パフォーマンス / セキュリティ / 使いやすさ / 拡張性
Q2: "絶対に避けたいことは？"
```

#### 複数視点分析（--personas）

7つの視点から要件を検討:

| ペルソナ | 観点 |
|---------|------|
| アーキテクト | システム設計、拡張性、保守性 |
| アナライザー | データフロー、ボトルネック、最適化 |
| フロントエンド | UI/UX、レスポンシブ、アクセシビリティ |
| バックエンド | API設計、データ処理、パフォーマンス |
| セキュリティ | 脆弱性、認証認可、データ保護 |
| DevOps | デプロイ、監視、スケーラビリティ |
| PM | スケジュール、リソース、リスク管理 |

### 4. requirement.md の生成

#### 出力構造

```markdown
# 要件定義書 - [プロジェクト名]

## 1. 概要
プロジェクトの目的と背景

## 2. 機能要件
[REQ-001] 機能名
- 詳細説明
- ユーザーストーリー

[REQ-002] 機能名
...

## 3. 非機能要件
[NFR-001] パフォーマンス要件
[NFR-002] セキュリティ要件
...

## 4. 制約事項
[CON-001] 技術的制約
[CON-002] ビジネス制約
...

## 5. 前提条件
[ASM-001] 前提条件
...

## 6. 用語集
ドメイン固有の用語定義
```

#### 番号体系

| プレフィックス | 意味 |
|---------------|------|
| REQ-XXX | 機能要件 |
| NFR-XXX | 非機能要件 |
| CON-XXX | 制約事項 |
| ASM-XXX | 前提条件 |

### 5. 保存先

```
.specs/[project-name]/requirement.md
```

プロジェクト名は英語ケバブケースに変換。

## YAGNI チェックリスト

以下は明示的な要件がない限り**含めない**:

- [ ] 複雑な権限管理
- [ ] 高度な分析・レポート機能
- [ ] APIバージョニング
- [ ] マルチテナント対応
- [ ] リアルタイム通知・更新
- [ ] ソーシャルログイン
- [ ] 詳細な監査ログ
- [ ] データ移行計画
- [ ] バッチ処理・定期実行
- [ ] 非同期処理
