# Tasks Phase - タスクリストの生成

## 概要

タスクリスト（tasks.md）を生成するフェーズ。
design.md を入力として、実装タスクを階層的に分解する。

**重要**: このフェーズはタスクリストの「生成」のみ。実装は行わない。

## 実行手順

### 1. 設計書の特定

```bash
find .specs -name "design.md" -type f
```

設計書から以下を抽出:
- 要件トレーサビリティマトリックス
- モジュール・クラス設計
- 技術スタック
- 実装ガイドライン

### 2. 既存実装の確認

新規 vs 拡張を判断:

```bash
# テストファイル
find . -name "*test*" -o -name "*spec*" -type f -not -path "*/node_modules/*"

# 既存コンポーネント
find . -type f \( -name "*Service*" -o -name "*Controller*" \) -not -path "*/node_modules/*"

# ビルド/開発スクリプト
cat package.json | jq '.scripts | keys[]'
```

### 3. タスク生成原則

1. すべてのタスクは要件IDまたは設計書と紐付け
2. 設計書にない機能のタスクは生成しない
3. 既存実装と重複するタスクは除外
4. 並列実行の機会を最大化

### 4. タスク構造

各タスクに含める項目:

| 項目 | 説明 |
|------|------|
| タスクID | T001, T002... |
| 要件ID | REQ-001, NFR-001... |
| タスク名 | 明確で実行可能な説明 |
| 設計書参照 | design.md L:123-145 |
| 依存関係 | 先に完了すべきタスク |
| 推定時間 | 完了までの時間 |
| 対象ファイル | 作成/修正するファイル |
| 完了条件 | 具体的な受け入れ基準 |

### 5. タスク階層（--hierarchy）

```
Epic（大規模機能）
└── Story（ユーザーストーリー）
    └── Task（開発タスク）
        └── Subtask（詳細タスク）
```

### 6. 実行戦略（AskUserQuestion で確認）

`--strategy` が未指定の場合、AskUserQuestion で確認:

```
Q1: "タスクの実行戦略は？"
header: "Strategy"
options:
  - "Systematic (Recommended)" / "包括的・体系的。品質ゲート重視"
  - "Agile" / "MVPファースト。スプリント単位で段階リリース"
  - "Enterprise" / "コンプライアンス重視。承認プロセス付き"

Q2: "タスクの粒度は？"
header: "Granularity"
options:
  - "標準（1タスク = 数時間〜1日）(Recommended)"
  - "細かい（1タスク = 1-2時間）"
  - "粗い（1タスク = 1-3日）"
```

| 戦略 | 特徴 |
|------|------|
| systematic | 包括的・体系的、品質ゲート重視 |
| agile | MVPファースト、スプリント単位 |
| enterprise | コンプライアンス重視、承認プロセス |

### 7. 見積もりとリスク（--estimate）

```markdown
- 信頼区間: 0.5h (楽観) / 1h (現実) / 2h (悲観)
- リスクレベル: 低/中/高
- 前提条件: 見積もりの前提
```

### 8. 出力構造

```markdown
# タスクリスト - [プロジェクト名]

## 1. 概要
設計書に基づくタスク分解

## 2. タスク一覧

### Phase 1: 基盤構築
- [ ] T001: 環境構築
- [ ] T002: データベース設定

### Phase 2: コア実装
- [ ] T003: [REQ-001] 認証機能
- [ ] T004: [REQ-002] データ管理

### Phase 3: テスト・ドキュメント
- [ ] T005: ユニットテスト
- [ ] T006: ドキュメント更新

## 3. タスク詳細

### T001: 環境構築
- 要件ID: -（基盤タスク）
- 設計書参照: design.md L:45-60
- 依存関係: なし
- 推定時間: 1時間
- 対象ファイル: package.json, .env
- 完了条件:
  - [ ] 依存関係がインストール済み
  - [ ] 開発環境が正常に起動
- 並列実行: T002と同時実行可能

### T003: [REQ-001] 認証機能
- 要件ID: REQ-001
- 設計書参照: design.md L:120-180
- 依存関係: T001
- 推定時間: 4時間
- 対象ファイル: src/auth/*, src/api/auth.ts
- 完了条件:
  - [ ] ログイン機能が動作
  - [ ] JWTトークンが正しく発行
  - [ ] 単体テストがパス

## 4. 依存関係図

```mermaid
graph LR
    T001 --> T003
    T001 --> T004
    T003 --> T005
    T004 --> T005
```

## 5. 並列実行計画

| フェーズ | 並列実行可能タスク |
|---------|-------------------|
| 1 | T001, T002 |
| 2 | T003, T004 |
| 3 | T005, T006 |
```

### 9. 保存先

```
.specs/[project-name]/tasks.md
```

## プロジェクトタイプ別推奨タスク

### Webアプリケーション
- 国際化対応の基盤実装
- アクセシビリティ対応
- コンポーネントライブラリ統合

### API サーバー
- API仕様書の作成
- エラーハンドリングの統一
- 認証・認可の実装

### データベース連携
- マイグレーションスクリプト
- インデックス設計
- バックアップ戦略（本番向け）

## 除外タスク（YAGNI）

以下は要件に明記がない限り**生成しない**:

- [ ] 詳細な監視・メトリクス収集
- [ ] 管理画面・ダッシュボード
- [ ] 高度なキャッシング戦略
- [ ] 負荷分散・スケーリング設定
- [ ] 詳細なパフォーマンステスト

## 品質チェックリスト

生成後の確認項目:

1. [ ] すべてのタスクが要件IDと紐付いているか
2. [ ] 設計書にない機能のタスクは含まれていないか
3. [ ] 依存関係が明確に定義されているか
4. [ ] 推定時間が現実的か
5. [ ] 完了条件が具体的で測定可能か
6. [ ] 並列実行の機会が最大化されているか
